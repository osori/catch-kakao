<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>캐치! 캐치! 카카오</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type="text/javascript">

var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
	game.load.image('muzi-cry', 'kakao-faces/2200001.thum_021.png' );
	game.load.image('muzi-aegyo', 'kakao-faces/2200001.thum_029.png');
	game.load.image('muzi-delightful', 'kakao-faces/2200001.thum_020.png');
	game.load.image('apeach-confident', 'kakao-faces/2200001.thum_056.png' );
	game.load.image('apeach-love', 'kakao-faces/2200001.thum_006.png');
	game.load.image('apeach-condescending', 'kakao-faces/2200001.thum_013.png');
	game.load.image('tube-angry', 'kakao-faces/2200002.thum_045.png');
	game.load.image('jayg-sing', 'kakao-faces/2200001.thum_039.png');
	game.load.image('neo-elastichair', 'kakao-faces/2200002.thum_007.png');
	game.load.image('neo-embarrassed', 'kakao-faces/2200002.thum_006.png');
	game.load.image('tube-cheerup', 'kakao-faces/2200002.thum_033.png');
	game.load.image('tube-yay', 'kakao-faces/2200002.thum_078.png');
	game.load.image('frodo-thumbsup', 'kakao-faces/2200002.thum_057.png');
	game.load.image('frodo-whistle', 'kakao-faces/2200002.thum_060.png');
	game.load.image('jayg-coffee', 'kakao-faces/2200001.thum_077.png');
	game.load.image('tube-angrytable', 'kakao-faces/2200002.thum_046.png');
	game.load.image('tube-angrykick', 'kakao-faces/2200002.thum_047.png');
	game.load.image('face-merong','kakao-faces/008.png')
}

var faces = [ 'muzi-aegyo', 'muzi-delightful' , 'apeach-love', 'jayg-sing', 'neo-elastichair', 'tube-cheerup', 'tube-yay', 'frodo-thumbsup'];

var bombs = ['tube-angrytable'];

KakaoFriend = function (index, game, speedWeight) {
	var x = game.world.randomX;
	var y = game.world.randomY;

	this.game = game;
	this.sprite = game.add.sprite(x, y, faces[Math.floor(Math.random() * faces.length)]);
	
	game.physics.enable(this.sprite, Phaser.Physics.ARCADE);
	this.sprite.anchor.set(0.5);
	this.sprite.body.immovable = false;
	this.sprite.body.collideWorldBounds = true;
	this.sprite.body.bounce.setTo(1,1);

	this.sprite.scale.setTo(2,2);

	this.sprite.angle = game.rnd.angle();

	this.sprite.inputEnabled=true;
	this.sprite.events.onInputDown.add(clickKakao, this);

	game.physics.arcade.velocityFromRotation(this.sprite.rotation, (100 + Math.sqrt(speedWeight * 10)) , this.sprite.body.velocity);

}

KakaoBomb = function (index, game, speedWeight) {
	var x = game.world.randomX;
	var y = game.world.randomY;

	this.game = game;
	this.sprite = game.add.sprite(x, y, bombs[Math.floor(Math.random() * bombs.length)]);
	
	game.physics.enable(this.sprite, Phaser.Physics.ARCADE);
	this.sprite.anchor.set(0.5);
	this.sprite.body.immovable = false;
	this.sprite.body.collideWorldBounds = true;
	this.sprite.body.bounce.setTo(1,1);

	this.sprite.scale.setTo(1.5,1.5);

	this.sprite.angle = game.rnd.angle();

	this.sprite.inputEnabled=true;
	this.sprite.events.onInputDown.add(clickKakao, this);

	game.physics.arcade.velocityFromRotation(this.sprite.rotation, (100 + Math.sqrt(speedWeight * 10)) , this.sprite.body.velocity);

}

var score = 0;
var scoreText;
var catchCount = 0;

var roundText;

function create() {

	game.physics.startSystem(Phaser.Physics.ARCADE);

	game.stage.backgroundColor = '#fcd411';
	scoreText = game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#432f2e' });
	roundText = game.add.text(16, 64, 'score: 0', { fontSize: '32px', fill: '#432f2e' });

	roundText.text = "currRound: 1";


	kakaoFriends = [];
	numKakaoFriends = 20;

	kakaoBombs = [];
	numKakaoBombs = 2;

	for (var i=0; i<numKakaoFriends; i++) {
		kakaoFriends.push(new KakaoFriend(i, game, 1));
	}

	for (var i=0; i<numKakaoBombs; i++) {
		kakaoBombs.push(new KakaoBomb(i, game, 1));
	}

    game.time.events.repeat(Phaser.Timer.SECOND * 20, 100000, createKakao, this);


}

function update() {


}

function render() {
}

function createKakao() {
	kakaoFriends.push(new KakaoFriend(numKakaoFriends, game, catchCount+1));
}

function clickKakao(kakao) {
	console.log(kakao.key);

	if (kakao.key == 'tube-angry' || kakao.key == 'tube-angrytable') {
		for (var i=0; i<5; i++) {
			kakaoFriends.push(new KakaoFriend(i, game, catchCount));
		}
		score -= 300;
		numKakaoFriends = kakaoFriends.length;
		kakaoBombs.pop(kakao);
		kakao.destroy();
		scoreText.text = 'Score: ' + score + ' numKakaoFriends: ' + numKakaoFriends;
	} else {
		kakaoFriends.pop(kakao);
		kakao.destroy();
		score += 50;
		catchCount += 1;
		numKakaoFriends = kakaoFriends.length;
		scoreText.text = 'Score: ' + score + ' numKakaoFriends: ' + numKakaoFriends;

	}

	if (isGameClear()) {
		scoreText.text = 'Game Clear! ' + 'Total Score: ' + score; 
		game.time.events.stop();
	}

}

function isGameClear() {
	if (numKakaoFriends == 0){
		return true;
	} else {
		return false;
	}
}

function showNextRound() {
	
}

</script>

</body>
</html>